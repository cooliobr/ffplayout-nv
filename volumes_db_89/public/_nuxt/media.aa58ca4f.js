import{_ as ue}from"./Menu.vue.db477a31.js";import{u as _e,_ as me,g as J,M as be}from"./media.3d510f16.js";import{a as he,b as ve,z as pe,m as fe,k as n,A as ge,B as ye,e as d,q as N,f as e,F as O,r as I,u as t,i as z,s as H,x as we,t as _,c as $e,y as ke,w as B,h as E,v as X,l as K,C as V,D as Ce,o as r}from"./entry.adf6f5f7.js";import{u as Q,a as Me,s as Te}from"./config.c2db4e89.js";import{u as xe}from"./auth.cb4bed8f.js";import"./nuxt-link.e332d9af.js";const Fe={class:"container-fluid browser-container"},Se={class:"h-100"},De={"aria-label":"breadcrumb"},Ne={class:"breadcrumb"},Ve=["active","onClick"],Pe={key:0,class:"link-secondary",href:"#"},Le={key:1},Re={class:"browser-div"},Ue={key:0,class:"d-flex justify-content-center loading-overlay"},Ae=e("div",{class:"spinner-border",role:"status"},null,-1),Oe=[Ae],Ie={key:0,class:"list-group media-browser-scroll m-1"},ze={class:"row"},He=e("div",{class:"col-1 browser-icons-col"},[e("i",{class:"bi-folder-fill browser-icons"})],-1),Be={class:"col browser-item-text"},qe=["onClick"],Ge={class:"col-1 folder-delete"},je=["onClick"],Je=e("i",{class:"bi-x-circle-fill"},null,-1),Ee=[Je],Xe={key:0,class:"list-group media-browser-scroll m-1"},Ke=["id"],Qe={class:"row"},We={class:"col-1 browser-icons-col"},Ye={key:0,class:"bi-music-note-beamed browser-icons"},Ze={key:1,class:"bi-film browser-icons"},et={key:2,class:"bi-file-earmark-image browser-icons"},tt={key:3,class:"bi-file-binary browser-icons"},st={class:"col browser-item-text grabbing"},at={class:"col-1 browser-play-col"},ot=["onClick"],lt=e("i",{class:"bi-play-fill"},null,-1),it=[lt],nt={class:"col-1 browser-dur-col"},rt={class:"duration"},dt={class:"col-1 file-rename"},ct=["onClick"],ut=e("i",{class:"bi-pencil-square"},null,-1),_t=[ut],mt={class:"col-1 file-delete"},bt=["onClick"],ht=e("i",{class:"bi-x-circle-fill"},null,-1),vt=[ht],pt={id:"previewModal",class:"modal",tabindex:"-1","aria-labelledby":"previewModalLabel","aria-hidden":"true"},ft={class:"modal-dialog modal-dialog-centered modal-xl"},gt={class:"modal-content"},yt={class:"modal-header"},wt={class:"modal-title fs-5",id:"previewModalLabel"},$t={class:"modal-body"},kt=["src","alt"],Ct={id:"deleteModal",class:"modal",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"},Mt={class:"modal-dialog modal-dialog-centered"},Tt={class:"modal-content"},xt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"deleteModalLabel"},"Delete File/Folder"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1),Ft={class:"modal-body"},St=e("br",null,null,-1),Dt={class:"modal-footer"},Nt={id:"renameModal",class:"modal",tabindex:"-1","aria-labelledby":"renameModalLabel","aria-hidden":"true"},Vt={class:"modal-dialog modal-dialog-centered"},Pt={class:"modal-content"},Lt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"renameModalLabel"},"Rename File"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1),Rt=["onSubmit"],Ut={class:"modal-body"},At=e("div",{class:"modal-footer"},[e("button",{type:"reset",class:"btn btn-primary","data-bs-dismiss":"modal","aria-label":"Cancel"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary","data-bs-dismiss":"modal"},"Ok")],-1),Ot=Ce('<div class="btn-group media-button"><button type="button" class="btn btn-primary" title="Create Folder" data-bs-toggle="modal" data-bs-target="#folderModal"><i class="bi-folder-plus"></i></button><button type="button" class="btn btn-primary" title="Upload File" data-bs-toggle="modal" data-bs-target="#uploadModal"><i class="bi-upload"></i></button></div>',1),It={id:"folderModal",class:"modal",tabindex:"-1","aria-labelledby":"folderModalLabel","aria-hidden":"true"},zt={class:"modal-dialog modal-dialog-centered"},Ht={class:"modal-content"},Bt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"folderModalLabel"},"Create Folder"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1),qt=["onSubmit"],Gt={class:"modal-body"},jt=e("div",{class:"modal-footer"},[e("button",{type:"reset",class:"btn btn-primary","data-bs-dismiss":"modal","aria-label":"Cancel"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary","data-bs-dismiss":"modal"},"Ok")],-1),Jt={class:"modal-dialog modal-dialog-centered modal-xl"},Et={class:"modal-content"},Xt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"uploadModalLabel"},"Upload Files"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1),Kt=["onSubmit"],Qt={class:"modal-body"},Wt=["accept"],Yt={class:"row"},Zt={class:"col-10"},es={class:"row progress-row"},ts={class:"col-1",style:{"min-width":"125px"}},ss={class:"col-10"},as={class:"progress"},os=["aria-valuenow"],ls=e("div",{class:"w-100"},null,-1),is=e("div",{class:"col-1",style:{"min-width":"125px"}},"Current:",-1),ns={class:"col-10"},rs={class:"progress"},ds=["aria-valuenow"],cs=e("div",{class:"w-100"},null,-1),us=e("div",{class:"col-1",style:{"min-width":"125px"}},"Uploading:",-1),_s={class:"col-10"},ms=e("div",{class:"col-2"},[e("div",{class:"media-button"},[e("button",{type:"reset",class:"btn btn-primary me-2","data-bs-dismiss":"modal"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary"},"Upload")])],-1),ws=he({__name:"media",setup(bs){const{$bootstrap:W}=ve(),C=xe(),c=Q(),i=Me(),o=_e(),{toMin:Y,mediaType:M}=Te(),P={"content-type":"application/json;charset=UTF-8"},{configID:Z}=pe(Q());fe({title:"Media | ffplayout"});const L=n(!1),w=n(""),T=n(""),v=n(""),$=n(""),R=n(""),U=n(),x=n(!1),q=n(),G=n(""),b=n(""),p=n([]),F=n(0),S=n(""),k=n(0),g=n(0),D=n(""),j=n(),m=n(new XMLHttpRequest);ge(async()=>{const s=[...c.configPlayout.storage.extensions,...c.configGui[c.configID].extra_extensions.split(",")].map(l=>`.${l}`);G.value=s.join(", "),j.value=W.Modal.getOrCreateInstance(q.value),o.folderTree.parent||h("")}),ye([Z],()=>{h("")});async function h(s){L.value=!0,await o.getTree(s),L.value=!1}function ee(s){let l=s;s.includes("/")||(l=`/${o.folderTree.parent}/${o.folderTree.source}/${s}`.replace(/\/[/]+/g,"/")),$.value=l.split("/").slice(-1)[0],R.value=encodeURIComponent(`${l}`).replace(/%2F/g,"/");const u=$.value.split(".").slice(-1)[0].toLowerCase(),y=M($.value)==="audio"?`audio/${u}`:`video/${u}`;c.configPlayout.storage.extensions.includes(`${u}`)?(x.value=!0,U.value={liveui:!1,controls:!0,suppressNotSupportedError:!0,autoplay:!1,preload:"auto",sources:[{type:y,src:R.value}]}):x.value=!1}async function te(){await fetch(`/api/file/${c.configGui[c.configID].id}/remove/`,{method:"POST",headers:{...P,...C.authHeader},body:JSON.stringify({source:w.value})}).then(async s=>{s.status!==200&&(i.alertVariant="alert-danger",i.alertMsg=`${await s.text()}`,i.showAlert=!0),h(o.folderTree.source)}).catch(s=>{i.alertVariant="alert-danger",i.alertMsg=`Delete error: ${s}`,i.showAlert=!0}),setTimeout(()=>{i.alertMsg="",i.showAlert=!1},5e3)}function se(s){v.value=s,T.value=s}async function ae(s){s.preventDefault(),await fetch(`/api/file/${c.configGui[c.configID].id}/rename/`,{method:"POST",headers:{...P,...C.authHeader},body:JSON.stringify({source:T.value,target:v.value})}).then(()=>{h(o.folderTree.source)}).catch(l=>{i.alertVariant="alert-danger",i.alertMsg=`Delete error: ${l}`,i.showAlert=!0}),T.value="",v.value=""}function oe(s){s.preventDefault(),T.value="",v.value=""}function le(){x.value=!1}async function ie(s){s.preventDefault();const l=`${o.folderTree.source}/${b.value}`.replace(/\/[/]+/g,"/");if(D.value=o.folderTree.source,o.folderTree.folders.includes(b.value)){i.alertVariant="alert-warning",i.alertMsg=`Folder "${b.value}" exists already!`,i.showAlert=!0;return}await $fetch(`/api/file/${c.configGui[c.configID].id}/create-folder/`,{method:"POST",headers:{...P,...C.authHeader},body:JSON.stringify({source:l})}).then(()=>{i.alertVariant="alert-success",i.alertMsg="Folder create done..."}).catch(u=>{i.alertVariant="alert-danger",i.alertMsg=`Folder create error: ${u}`}),i.showAlert=!0,b.value="",setTimeout(()=>{i.alertMsg="",i.showAlert=!1},2e3),h(D.value)}function ne(s){s.preventDefault(),b.value=""}function re(s){const l=s.target.files||s.dataTransfer.files;l.length&&(p.value=l)}async function de(s){s.preventDefault(),D.value=o.folderTree.source;for(let l=0;l<p.value.length;l++){const u=p.value[l];S.value=u.name,F.value=l+1;const y=new FormData;y.append(u.name,u),m.value=new XMLHttpRequest,m.value.open("PUT",`/api/file/${c.configGui[c.configID].id}/upload/?path=${encodeURIComponent(o.crumbs[o.crumbs.length-1].path)}`),m.value.setRequestHeader("Authorization",`Bearer ${C.jwtToken}`),m.value.upload.onprogress=function(a){g.value=Math.round(100*a.loaded/a.total)},m.value.upload.onerror=function(){i.alertVariant="alert-danger",i.alertMsg=`Upload error: ${m.value.status}`,i.showAlert=!0},m.value.onload=function(){k.value=F.value*100/p.value.length,g.value=100},m.value.send(y)}S.value="Done...",h(D.value),setTimeout(()=>{j.value.hide(),F.value=0,g.value=0,k.value=0,p.value=[],i.showAlert=!1},1e3)}function ce(s){s.preventDefault(),p.value=[],k.value=0,g.value=0,S.value="",m.value.abort()}return(s,l)=>{const u=ue,y=me;return r(),d("div",null,[N(u),e("div",Fe,[e("div",Se,[e("div",null,[e("nav",De,[e("ol",Ne,[(r(!0),d(O,null,I(t(o).crumbs,(a,f)=>(r(),d("li",{class:"breadcrumb-item",key:f,active:f===t(o).crumbs.length-1,onClick:A=>h(a.path)},[t(o).crumbs.length>1&&t(o).crumbs.length-1>f?(r(),d("a",Pe,_(a.text),1)):(r(),d("span",Le,_(a.text),1))],8,Ve))),128))])])]),e("div",Re,[t(L)?(r(),d("div",Ue,Oe)):z("",!0),N(t(be),{class:we(["pane-row",s.$route.path==="/player"?"browser-splitter":""]),horizontal:s.$route.path==="/player"},{default:H(()=>[N(t(J),{"min-size":"14","max-size":"80",size:"24",style:V(s.$route.path==="/player"?`height: ${t(o).folderTree.folders.length*47+2}px`:"")},{default:H(()=>[t(o).folderTree.parent?(r(),d("ul",Ie,[(r(!0),d(O,null,I(t(o).folderTree.folders,a=>(r(),d("li",{class:"list-group-item browser-item",key:a},[e("div",ze,[He,e("div",Be,[e("a",{class:"link-light",href:"#",onClick:f=>h(`/${t(o).folderTree.source}/${a}`)},_(a),9,qe)]),e("div",Ge,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#deleteModal",onClick:f=>w.value=`/${t(o).folderTree.source}/${a}`.replace(/\/[/]+/g,"/")},Ee,8,je)])])]))),128))])):z("",!0)]),_:1},8,["style"]),N(t(J),{style:V(s.$route.path==="/player"?`height: ${t(o).folderTree.files.length*26+2}px`:"")},{default:H(()=>[t(o).folderTree.parent?(r(),d("ul",Xe,[(r(!0),d(O,null,I(t(o).folderTree.files,(a,f)=>(r(),d("li",{id:`file_${f}`,class:"draggable list-group-item browser-item",key:a.name},[e("div",Qe,[e("div",We,[t(M)(a.name)==="audio"?(r(),d("i",Ye)):t(M)(a.name)==="video"?(r(),d("i",Ze)):t(M)(a.name)==="image"?(r(),d("i",et)):(r(),d("i",tt))]),e("div",st,_(a.name),1),e("div",at,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#previewModal",onClick:A=>ee(a.name)},it,8,ot)]),e("div",nt,[e("span",rt,_(t(Y)(a.duration)),1)]),e("div",dt,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#renameModal",onClick:A=>se(`/${t(o).folderTree.source}/${a.name}`.replace(/\/[/]+/g,"/"))},_t,8,ct)]),e("div",mt,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#deleteModal",onClick:A=>w.value=`/${t(o).folderTree.source}/${a.name}`.replace(/\/[/]+/g,"/")},vt,8,bt)])])],8,Ke))),128))])):z("",!0)]),_:1},8,["style"])]),_:1},8,["class","horizontal"])])]),e("div",pt,[e("div",ft,[e("div",gt,[e("div",yt,[e("h1",wt,"Preview: "+_(t($)),1),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel",onClick:l[0]||(l[0]=a=>le())})]),e("div",$t,[t(x)&&t(U)?(r(),$e(y,{key:0,reference:"previewPlayer",options:t(U)},null,8,["options"])):(r(),d("img",{key:1,src:t(R),class:"img-fluid",alt:t($)},null,8,kt))])])])]),e("div",Ct,[e("div",Mt,[e("div",Tt,[xt,e("div",Ft,[e("p",null,[ke(" Are you sure that you want to delete:"),St,e("strong",null,_(t(w)),1)])]),e("div",Dt,[e("button",{type:"reset",class:"btn btn-primary","data-bs-dismiss":"modal","aria-label":"Cancel",onClick:l[1]||(l[1]=a=>w.value="")}," Cancel "),e("button",{type:"submit",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:te}," Ok ")])])])]),e("div",Nt,[e("div",Vt,[e("div",Pt,[Lt,e("form",{onSubmit:B(ae,["prevent"]),onReset:oe},[e("div",Ut,[E(e("input",{type:"text",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=a=>K(v)?v.value=a:null)},null,512),[[X,t(v)]])]),At],40,Rt)])])])]),Ot,e("div",It,[e("div",zt,[e("div",Ht,[Bt,e("form",{onSubmit:B(ie,["prevent"]),onReset:ne},[e("div",Gt,[E(e("input",{type:"text",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=a=>K(b)?b.value=a:null)},null,512),[[X,t(b)]])]),jt],40,qt)])])]),e("div",{id:"uploadModal",ref_key:"uploadModal",ref:q,class:"modal",tabindex:"-1","aria-labelledby":"uploadModalLabel","data-bs-backdrop":"static"},[e("div",Jt,[e("div",Et,[Xt,e("form",{onSubmit:B(de,["prevent"]),onReset:ce},[e("div",Qt,[e("input",{class:"form-control",type:"file",accept:t(G),onChange:re,multiple:""},null,40,Wt),e("div",Yt,[e("div",Zt,[e("div",es,[e("div",ts," Overall ("+_(t(F))+"/"+_(t(p).length)+"): ",1),e("div",ss,[e("div",as,[e("div",{class:"progress-bar bg-warning",role:"progressbar","aria-valuenow":t(k),style:V(`width: ${t(k)}%`)},null,12,os)])]),ls,is,e("div",ns,[e("div",rs,[e("div",{class:"progress-bar bg-warning",role:"progressbar","aria-valuenow":t(g),style:V(`width: ${t(g)}%`)},null,12,ds)])]),cs,us,e("div",_s,[e("strong",null,_(t(S)),1)])])]),ms])])],40,Kt)])])],512)])}}});export{ws as default};
