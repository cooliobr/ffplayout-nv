import{_ as ee}from"./Menu.vue.69109358.js";import{a as E,z as te,k as i,A as J,B as se,o as r,e as d,f as e,F as O,r as z,u as t,t as f,i as B,q as F,s as H,C as N,x as ae,c as oe,y as le,w as G,h as X,v as K,l as Q,D as ie,E as ne,G as re,b as de,m as ce,H as ue}from"./entry.230716bf.js";import{u as W}from"./auth.be8628dd.js";import{u as j,a as Y,s as _e}from"./config.5c5d946d.js";import{u as Z,g as q,M as me,_ as be}from"./splitpanes.246f76d6.js";import"./nuxt-link.3b6951aa.js";const g=S=>(ie("data-v-810a3deb"),S=S(),ne(),S),pe={class:"h-100"},he={"aria-label":"breadcrumb"},ve={class:"breadcrumb"},fe=["active","onClick"],ge={key:0,class:"link-secondary",href:"#"},ye={key:1},we={class:"browser-div"},$e={key:0,class:"d-flex justify-content-center loading-overlay"},ke=g(()=>e("div",{class:"spinner-border",role:"status"},null,-1)),Ce=[ke],Me={key:0,class:"list-group media-browser-scroll m-1"},xe={class:"row"},Te=g(()=>e("div",{class:"col-1 browser-icons-col"},[e("i",{class:"bi-folder-fill browser-icons"})],-1)),Se={class:"col browser-item-text"},Fe=["onClick"],De={class:"col-1 folder-delete"},Pe=["onClick"],Ne=g(()=>e("i",{class:"bi-x-circle-fill"},null,-1)),Ve=[Ne],Ue={key:0,class:"list-group media-browser-scroll m-1"},Ie=["id"],Le={class:"row"},Re={class:"col-1 browser-icons-col"},Ae={key:0,class:"bi-music-note-beamed browser-icons"},Oe={key:1,class:"bi-film browser-icons"},ze={key:2,class:"bi-file-earmark-image browser-icons"},Be={key:3,class:"bi-file-binary browser-icons"},He={class:"col browser-item-text grabbing"},Ge={class:"col-1 browser-play-col"},je=["onClick"],qe=g(()=>e("i",{class:"bi-play-fill"},null,-1)),Ee=[qe],Je={class:"col-1 browser-dur-col"},Xe={class:"duration"},Ke={class:"col-1 file-rename"},Qe=["onClick"],We=g(()=>e("i",{class:"bi-pencil-square"},null,-1)),Ye=[We],Ze={class:"col-1 file-delete"},et=["onClick"],tt=g(()=>e("i",{class:"bi-x-circle-fill"},null,-1)),st=[tt],at={id:"previewModal",class:"modal",tabindex:"-1","aria-labelledby":"previewModalLabel","aria-hidden":"true"},ot={class:"modal-dialog modal-dialog-centered modal-xl"},lt={class:"modal-content"},it={class:"modal-header"},nt={class:"modal-title fs-5",id:"previewModalLabel"},rt={class:"modal-body"},dt=["src","alt"],ct={id:"deleteModal",class:"modal",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"},ut={class:"modal-dialog modal-dialog-centered"},_t={class:"modal-content"},mt=g(()=>e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"deleteModalLabel"},"Delete File/Folder"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1)),bt={class:"modal-body"},pt=g(()=>e("br",null,null,-1)),ht={class:"modal-footer"},vt={id:"renameModal",class:"modal",tabindex:"-1","aria-labelledby":"renameModalLabel","aria-hidden":"true"},ft={class:"modal-dialog modal-dialog-centered"},gt={class:"modal-content"},yt=g(()=>e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"renameModalLabel"},"Rename File"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1)),wt=["onSubmit"],$t={class:"modal-body"},kt=g(()=>e("div",{class:"modal-footer"},[e("button",{type:"reset",class:"btn btn-primary","data-bs-dismiss":"modal","aria-label":"Cancel"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary","data-bs-dismiss":"modal"},"Ok")],-1)),Ct=E({__name:"Browser",setup(S){const D=W(),k=j(),n=Y(),a=Z(),{toMin:C,mediaType:M}=_e(),x={"content-type":"application/json;charset=UTF-8"},{configID:P}=te(j()),T=i(!1),c=i(""),_=i(""),m=i(""),p=i(""),y=i(""),h=i(),w=i(!1);J(()=>{a.folderTree.parent||$("")}),se([P],()=>{$("")});async function $(s){T.value=!0,await a.getTree(s),T.value=!1}function b(s){let l=s;s.includes("/")||(l=`/${a.folderTree.parent}/${a.folderTree.source}/${s}`.replace(/\/[/]+/g,"/")),p.value=l.split("/").slice(-1)[0],y.value=encodeURIComponent(`${l}`).replace(/%2F/g,"/");const u=p.value.split(".").slice(-1)[0].toLowerCase(),o=M(p.value)==="audio"?`audio/${u}`:`video/${u}`;k.configPlayout.storage.extensions.includes(`${u}`)?(w.value=!0,h.value={liveui:!1,controls:!0,suppressNotSupportedError:!0,autoplay:!1,preload:"auto",sources:[{type:o,src:y.value}]}):w.value=!1}async function V(){await fetch(`/api/file/${k.configGui[k.configID].id}/remove/`,{method:"POST",headers:{...x,...D.authHeader},body:JSON.stringify({source:c.value})}).then(async s=>{s.status!==200&&(n.alertVariant="alert-danger",n.alertMsg=`${await s.text()}`,n.showAlert=!0),$(a.folderTree.source)}).catch(s=>{n.alertVariant="alert-danger",n.alertMsg=`Delete error: ${s}`,n.showAlert=!0}),setTimeout(()=>{n.alertMsg="",n.showAlert=!1},5e3)}function U(s){m.value=s,_.value=s}async function I(s){s.preventDefault(),await fetch(`/api/file/${k.configGui[k.configID].id}/rename/`,{method:"POST",headers:{...x,...D.authHeader},body:JSON.stringify({source:_.value,target:m.value})}).then(()=>{$(a.folderTree.source)}).catch(l=>{n.alertVariant="alert-danger",n.alertMsg=`Delete error: ${l}`,n.showAlert=!0}),_.value="",m.value=""}function L(s){s.preventDefault(),_.value="",m.value=""}function R(){w.value=!1}return(s,l)=>{const u=be;return r(),d("div",null,[e("div",pe,[e("div",null,[e("nav",he,[e("ol",ve,[(r(!0),d(O,null,z(t(a).crumbs,(o,v)=>(r(),d("li",{class:"breadcrumb-item",key:v,active:v===t(a).crumbs.length-1,onClick:A=>$(o.path)},[t(a).crumbs.length>1&&t(a).crumbs.length-1>v?(r(),d("a",ge,f(o.text),1)):(r(),d("span",ye,f(o.text),1))],8,fe))),128))])])]),e("div",we,[t(T)?(r(),d("div",$e,Ce)):B("",!0),F(t(me),{class:ae(["pane-row",s.$route.path==="/player"?"browser-splitter":""]),horizontal:s.$route.path==="/player"},{default:H(()=>[F(t(q),{"min-size":"14","max-size":"80",size:"24",style:N(s.$route.path==="/player"?`height: ${t(a).folderTree.folders.length*47+2}px`:"")},{default:H(()=>[t(a).folderTree.parent?(r(),d("ul",Me,[(r(!0),d(O,null,z(t(a).folderTree.folders,o=>(r(),d("li",{class:"list-group-item browser-item",key:o},[e("div",xe,[Te,e("div",Se,[e("a",{class:"link-light",href:"#",onClick:v=>$(`/${t(a).folderTree.source}/${o}`)},f(o),9,Fe)]),e("div",De,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#deleteModal",onClick:v=>c.value=`/${t(a).folderTree.source}/${o}`.replace(/\/[/]+/g,"/")},Ve,8,Pe)])])]))),128))])):B("",!0)]),_:1},8,["style"]),F(t(q),{style:N(s.$route.path==="/player"?`height: ${t(a).folderTree.files.length*26+2}px`:"")},{default:H(()=>[t(a).folderTree.parent?(r(),d("ul",Ue,[(r(!0),d(O,null,z(t(a).folderTree.files,(o,v)=>(r(),d("li",{id:`file_${v}`,class:"draggable list-group-item browser-item",key:o.name},[e("div",Le,[e("div",Re,[t(M)(o.name)==="audio"?(r(),d("i",Ae)):t(M)(o.name)==="video"?(r(),d("i",Oe)):t(M)(o.name)==="image"?(r(),d("i",ze)):(r(),d("i",Be))]),e("div",He,f(o.name),1),e("div",Ge,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#previewModal",onClick:A=>b(o.name)},Ee,8,je)]),e("div",Je,[e("span",Xe,f(t(C)(o.duration)),1)]),e("div",Ke,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#renameModal",onClick:A=>U(`/${t(a).folderTree.source}/${o.name}`.replace(/\/[/]+/g,"/"))},Ye,8,Qe)]),e("div",Ze,[e("a",{href:"#",class:"btn-link","data-bs-toggle":"modal","data-bs-target":"#deleteModal",onClick:A=>c.value=`/${t(a).folderTree.source}/${o.name}`.replace(/\/[/]+/g,"/")},st,8,et)])])],8,Ie))),128))])):B("",!0)]),_:1},8,["style"])]),_:1},8,["class","horizontal"])])]),e("div",at,[e("div",ot,[e("div",lt,[e("div",it,[e("h1",nt,"Preview: "+f(t(p)),1),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel",onClick:l[0]||(l[0]=o=>R())})]),e("div",rt,[t(w)&&t(h)?(r(),oe(u,{key:0,reference:"previewPlayer",options:t(h)},null,8,["options"])):(r(),d("img",{key:1,src:t(y),class:"img-fluid",alt:t(p)},null,8,dt))])])])]),e("div",ct,[e("div",ut,[e("div",_t,[mt,e("div",bt,[e("p",null,[le(" Are you sure that you want to delete:"),pt,e("strong",null,f(t(c)),1)])]),e("div",ht,[e("button",{type:"reset",class:"btn btn-primary","data-bs-dismiss":"modal","aria-label":"Cancel",onClick:l[1]||(l[1]=o=>c.value="")}," Cancel "),e("button",{type:"submit",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:V}," Ok ")])])])]),e("div",vt,[e("div",ft,[e("div",gt,[yt,e("form",{onSubmit:G(I,["prevent"]),onReset:L},[e("div",$t,[X(e("input",{type:"text",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=o=>Q(m)?m.value=o:null)},null,512),[[K,t(m)]])]),kt],40,wt)])])])])}}});const Mt=re(Ct,[["__scopeId","data-v-810a3deb"]]),xt={class:"container-fluid browser-container"},Tt=ue('<div class="btn-group media-button"><button type="button" class="btn btn-primary" title="Create Folder" data-bs-toggle="modal" data-bs-target="#folderModal"><i class="bi-folder-plus"></i></button><button type="button" class="btn btn-primary" title="Upload File" data-bs-toggle="modal" data-bs-target="#uploadModal"><i class="bi-upload"></i></button></div>',1),St={id:"folderModal",class:"modal",tabindex:"-1","aria-labelledby":"folderModalLabel","aria-hidden":"true"},Ft={class:"modal-dialog modal-dialog-centered"},Dt={class:"modal-content"},Pt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"folderModalLabel"},"Create Folder"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1),Nt=["onSubmit"],Vt={class:"modal-body"},Ut=e("div",{class:"modal-footer"},[e("button",{type:"reset",class:"btn btn-primary","data-bs-dismiss":"modal","aria-label":"Cancel"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary","data-bs-dismiss":"modal"},"Ok")],-1),It={class:"modal-dialog modal-dialog-centered modal-xl"},Lt={class:"modal-content"},Rt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"uploadModalLabel"},"Upload Files"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cancel"})],-1),At=["onSubmit"],Ot={class:"modal-body"},zt=["accept"],Bt={class:"row"},Ht={class:"col-10"},Gt={class:"row progress-row"},jt={class:"col-1",style:{"min-width":"125px"}},qt={class:"col-10 progress"},Et=["aria-valuenow"],Jt=e("div",{class:"w-100"},null,-1),Xt=e("div",{class:"col-1",style:{"min-width":"125px"}},"Current:",-1),Kt={class:"col-10 progress"},Qt=["aria-valuenow"],Wt=e("div",{class:"w-100"},null,-1),Yt=e("div",{class:"col-1",style:{"min-width":"125px"}},"Uploading:",-1),Zt={class:"col-10"},es=e("div",{class:"col-2"},[e("div",{class:"media-button"},[e("button",{type:"reset",class:"btn btn-primary me-2","data-bs-dismiss":"modal"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary"},"Upload")])],-1),ns=E({__name:"media",setup(S){const{$bootstrap:D}=de(),k=W(),n=j(),a=Y(),C=Z(),M={"content-type":"application/json;charset=UTF-8"};ce({title:"Media | ffplayout"});const x=i(),P=i(),T=i(""),c=i(""),_=i([]),m=i(0),p=i(""),y=i(0),h=i(0),w=i(""),$=i(),b=i(new XMLHttpRequest);J(async()=>{const s=[...n.configPlayout.storage.extensions,...n.configGui[n.configID].extra_extensions.split(",")].map(l=>`.${l}`);T.value=s.join(", "),$.value=D.Modal.getOrCreateInstance(P.value)});async function V(s){s.preventDefault();const l=`${C.folderTree.source}/${c.value}`.replace(/\/[/]+/g,"/");if(w.value=C.folderTree.source,C.folderTree.folders.includes(c.value)){a.alertVariant="alert-warning",a.alertMsg=`Folder "${c.value}" exists already!`,a.showAlert=!0;return}await $fetch(`/api/file/${n.configGui[n.configID].id}/create-folder/`,{method:"POST",headers:{...M,...k.authHeader},body:JSON.stringify({source:l})}).then(()=>{a.alertVariant="alert-success",a.alertMsg="Folder create done..."}).catch(u=>{a.alertVariant="alert-danger",a.alertMsg=`Folder create error: ${u}`}),a.showAlert=!0,c.value="",setTimeout(()=>{a.alertMsg="",a.showAlert=!1},2e3),x.value.getPath(w.value)}function U(s){s.preventDefault(),c.value=""}function I(s){const l=s.target.files||s.dataTransfer.files;l.length&&(_.value=l)}async function L(s){s.preventDefault(),w.value=C.folderTree.source;for(let l=0;l<_.value.length;l++){const u=_.value[l];p.value=u.name,m.value=l+1;const o=new FormData;o.append(u.name,u),b.value=new XMLHttpRequest,b.value.open("PUT",`/api/file/${n.configGui[n.configID].id}/upload/?path=${encodeURIComponent(C.crumbs[C.crumbs.length-1].path)}`),b.value.setRequestHeader("Authorization",`Bearer ${k.jwtToken}`),b.value.upload.onprogress=function(v){h.value=Math.round(100*v.loaded/v.total)},b.value.upload.onerror=function(){a.alertVariant="alert-danger",a.alertMsg=`Upload error: ${b.value.status}`,a.showAlert=!0},b.value.onload=function(){y.value=m.value*100/_.value.length,h.value=100},b.value.send(o)}p.value="Done...",x.value.getPath(w.value),setTimeout(()=>{$.value.hide(),m.value=0,h.value=0,y.value=0,_.value=[],a.showAlert=!1},1e3)}function R(s){s.preventDefault(),_.value=[],y.value=0,h.value=0,p.value="",b.value.abort()}return(s,l)=>{const u=ee;return r(),d("div",null,[F(u),e("div",xt,[F(Mt,{ref_key:"browser",ref:x},null,512)]),Tt,e("div",St,[e("div",Ft,[e("div",Dt,[Pt,e("form",{onSubmit:G(V,["prevent"]),onReset:U},[e("div",Vt,[X(e("input",{type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=o=>Q(c)?c.value=o:null)},null,512),[[K,t(c)]])]),Ut],40,Nt)])])]),e("div",{id:"uploadModal",ref_key:"uploadModal",ref:P,class:"modal",tabindex:"-1","aria-labelledby":"uploadModalLabel","data-bs-backdrop":"static"},[e("div",It,[e("div",Lt,[Rt,e("form",{onSubmit:G(L,["prevent"]),onReset:R},[e("div",Ot,[e("input",{class:"form-control",type:"file",accept:t(T),onChange:I,multiple:""},null,40,zt),e("div",Bt,[e("div",Ht,[e("div",Gt,[e("div",jt," Overall ("+f(t(m))+"/"+f(t(_).length)+"): ",1),e("div",qt,[e("div",{class:"progress-bar bg-warning",role:"progressbar","aria-valuenow":t(y),style:N(`width: ${t(y)}%`)},null,12,Et)]),Jt,Xt,e("div",Kt,[e("div",{class:"progress-bar bg-warning",role:"progressbar","aria-valuenow":t(h),style:N(`width: ${t(h)}%`)},null,12,Qt)]),Wt,Yt,e("div",Zt,[e("strong",null,f(t(p)),1)])])]),es])])],40,At)])])],512)])}}});export{ns as default};
