import{k as m,B as k,Z as y,N as S}from"./entry.adf6f5f7.js";const T=decodeURIComponent,x=encodeURIComponent,v=/; */,d=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function b(e,n){if(typeof e!="string")throw new TypeError("argument str must be a string");let o={},t=n||{},i=e.split(v),a=t.decode||T;for(let r=0;r<i.length;r++){let s=i[r],l=s.indexOf("=");if(l<0)continue;let h=s.substr(0,l).trim(),c=s.substr(++l,s.length).trim();c[0]=='"'&&(c=c.slice(1,-1)),o[h]==null&&(o[h]=C(c,a))}return o}function w(e,n,o){let t=o||{},i=t.encode||x;if(typeof i!="function")throw new TypeError("option encode is invalid");if(!d.test(e))throw new TypeError("argument name is invalid");let a=i(n);if(a&&!d.test(a))throw new TypeError("argument val is invalid");let r=e+"="+a;if(t.maxAge!=null){let s=t.maxAge-0;if(isNaN(s)||!isFinite(s))throw new TypeError("option maxAge is invalid");r+="; Max-Age="+Math.floor(s)}if(t.domain){if(!d.test(t.domain))throw new TypeError("option domain is invalid");r+="; Domain="+t.domain}if(t.path){if(!d.test(t.path))throw new TypeError("option path is invalid");r+="; Path="+t.path}if(t.expires){if(typeof t.expires.toUTCString!="function")throw new TypeError("option expires is invalid");r+="; Expires="+t.expires.toUTCString()}if(t.httpOnly&&(r+="; HttpOnly"),t.secure&&(r+="; Secure"),t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r}function C(e,n){try{return n(e)}catch{return e}}const E={path:"/",watch:!0,decode:e=>y(decodeURIComponent(e)),encode:e=>encodeURIComponent(typeof e=="string"?e:JSON.stringify(e))};function p(e,n){var a;const o={...E,...n},t=I(o)||{},i=m(t[e]??((a=o.default)==null?void 0:a.call(o)));{const r=()=>{L(e,i.value,o)};o.watch?k(i,r,{deep:o.watch!=="shallow"}):r()}return i}function I(e={}){return b(document.cookie,e)}function A(e,n,o={}){return n==null?w(e,n,{...o,maxAge:-1}):w(e,n,o)}function L(e,n,o={}){document.cookie=A(e,n,o)}function f(e){this.message=e}f.prototype=new Error,f.prototype.name="InvalidCharacterError";var g=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new f("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,t,i=0,a=0,r="";t=n.charAt(a++);~t&&(o=i%4?64*o+t:t,i++%4)?r+=String.fromCharCode(255&o>>(-2*i&6)):0)t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t);return r};function U(e){var n=e.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw"Illegal base64url string!"}try{return function(o){return decodeURIComponent(g(o).replace(/(.)/g,function(t,i){var a=i.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}(n)}catch{return g(n)}}function u(e){this.message=e}function O(e,n){if(typeof e!="string")throw new u("Invalid token specified");var o=(n=n||{}).header===!0?0:1;try{return JSON.parse(U(e.split(".")[o]))}catch(t){throw new u("Invalid token specified: "+t.message)}}u.prototype=new Error,u.prototype.name="InvalidTokenError";const j=S("auth",{state:()=>({isLogin:!1,jwtToken:"",authHeader:{}}),getters:{},actions:{updateToken(e){const n=p("token",{path:"/",maxAge:31536e3,sameSite:"lax"});n.value=e,this.jwtToken=e,this.authHeader={Authorization:`Bearer ${e}`}},updateIsLogin(e){this.isLogin=e},removeToken(){const e=p("token");e.value=null,this.jwtToken="",this.authHeader={}},async obtainToken(e,n){let o=0;const t={username:e,password:n};return await fetch("/auth/login/",{method:"POST",headers:new Headers([["content-type","application/json;charset=UTF-8"]]),body:JSON.stringify(t)}).then(i=>(o=i.status,i)).then(i=>i.json()).then(i=>{this.updateToken(i.user.token),this.updateIsLogin(!0)}).catch(i=>{i.status&&(o=i.status)}),o},inspectToken(){let e=p("token").value;if(e===null&&(e=""),e){this.updateToken(e);const n=O(e),o=Date.now()/1e3,t=n.exp;t&&this.jwtToken&&t-o>15?this.updateIsLogin(!0):this.updateIsLogin(!1)}else this.updateIsLogin(!1)}}});export{p as a,j as u};
